;$(function(){function j(a){return Math.floor(a/e)*g/e}function k(a){return a%e*g/e}function l(a,b){if(m(a)&&!h){var c={top:a.css("top"),left:a.css("left")};h=!0,a.animate({top:i.top,left:i.left},b,function(){h=!1,i=c,f++,t(),0!=b&&u(),n()&&0!==f&&0!==b&&v()})}}function m(a){var b={vertical:Math.abs(parseInt(a.css("top"))-parseInt(i.top)),horizon:Math.abs(parseInt(a.css("left"))-parseInt(i.left))};return b.vertical+b.horizon===Math.ceil(g/e)||b.vertical+b.horizon===Math.floor(g/e)}function n(){for(var a=0;e*e-1>a;a++){var c=$(b[a]).css("background-position").split(" ");if(parseInt($(b[a]).css("top"))!==-parseInt(c[1])||parseInt($(b[a]).css("left"))!==-parseInt(c[0]))return!1}return!0}function o(){$("#puzzlearea div").remove(),i={top:j(e*e-1),left:k(e*e-1)};for(var c=0;e*e-1>c;c++)a.append($("<div></div>").text(c+1)),b=a.find("div"),$(b[c]).addClass("puzzlepiece"),$(b[c]).css({top:j(c),left:k(c),"background-position":-1*k(c)+"px "+-1*j(c)+"px",width:g/e-4+"px",height:g/e-4+"px"}),$(b[c]).click(function(a){l($(a.target),300)});u()}function p(){var c=400;for($(b).fadeIn("100"),$("#puzzlearea h2").fadeOut("100"),a.css("background-image","none");c--;){var d=Math.floor(Math.random()*(e*e-1));l($(b[d]),0)}f=0,t(),u()}function q(){$("#change-bg").change(function(a){for(var c=0;e*e-1>c;c++)$(b[c]).css("background-image","url("+$(a.target).val()+".jpg)")}),$("#change-len").change(function(b){e=parseInt($(b.target).val()),a.css("background-image","none"),o()})}function r(a){for(var b=["background","background1","background2","background3"],c=["4x4","5x5","6x6","7x7"],e=$("<select id='change-bg'></select>"),f=$("<select id='change-len'></select>"),g=0;4>g;g++)e.append($("<option></option>").text(b[g]).attr("value",b[g])),f.append($("<option></option>").text(c[g]).attr("value",c[g]));d.append(e),d.append(f),a()}function s(){var a=$('<span id="screen"></span>');d.append(a),t()}function t(){$("#screen").text(f)}function u(){for(var a=0;e*e-1>a;a++)$(b[a]).removeClass("movablepiece"),m($(b[a]))&&$(b[a]).addClass("movablepiece")}function v(){a.css("background-image","url("+$("#change-bg").val()+".jpg)"),a.append($("<h2></h2>").text("You Win!\nsteps:"+f)),$(b).fadeOut("100")}var i,a=$("#puzzlearea"),b=a.find("div"),c=$("#shufflebutton"),d=$("#controls"),e=4,f=0,g=400,h=!1;o(),r(q),s(),c.click(p)});